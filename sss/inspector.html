<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <link href="inspector.css" rel="stylesheet" media="all">
    <script src="inspector.js"></script>
    <script src="../math/Number.js"></script>
    <title>Inspector </title>
</head>

<body>
<p><b id=docName></b> &nbsp;
<a href="https://maeyler.github.io/JS/sss/">Read me</a> &nbsp;
<a href="https://maeyler.github.io/JS/sss/Turkish">Turkish</a>
</p>
<script>
"use strict";
const RDR2 = new FileReader();
RDR2.onload = function() { display(RDR2) };
function fileSelect(t) { 
//target t is the file selection HTMLInputElement
    let a = t.files; //display(t);
    if (a.length == 0) return;
    display(RDR2);
    if (a.length == 1) {
        let f = a[0]; display(f);
        MENU.displayFile(f)
    } else {
        display(a);
        let s = "";
        for (let f of a) 
            s += f.name+" "+f.size+" bytes "+NL;
        MENU.displayText(s)
    }
}
var a, b, c;  //global variables
class Menu {
  constructor() {}
  allKeysIn(obj) {
    let s = []; for (let k in obj) s.push(k);
    return s;
  }
  allValuesOf(obj) {
    let s = []; for (let k in obj) s.push(obj[k]);
    return s;
  }
  isTextFile(f) {
    console.assert(f instanceof File);
    return f.type.startsWith("text") || f.name.endsWith(".md")
         || f.name.endsWith(".js") || f.name.endsWith(".java");
  }
  displayFile(f) {
    console.assert(f instanceof File); let M = this;
    console.log(f.name+" "+f.size+" bytes "+f.type);
    if (f.type.startsWith("image")) {
        RDR2.onload = function(evt) {
            M.displayImage(RDR2.result)
        };
        RDR2.readAsDataURL(f);
    } else if (this.isTextFile(f)) {
        RDR2.onload = function(evt) {
            M.displayText(RDR2.result)
        };
        RDR2.readAsText(f);
    } else {
        this.displayText("Unknown")
    }
  }
  displayText(txt) {
    disp1.innerText = txt; disp2.src = ""; 
    return disp1
  }
  displayImage(url) {
    disp1.innerText = ""; disp2.src = url; 
    return disp2
  }
  toString() { return "[object Menu]" }
}
function init() {
    let s = "Small is beautiful", d = new Date(),
       len = 123, name = "Circle", pi = Math.PI, 
       sqrt = Math.sqrt, power = Math.pow;
    a = [0, 11, "22", "abc"]; b = new Set(a);
    c = {len, name, pi, sqrt, power};
    MENU = {s, d, a, b, c, window, navigator, document};
    Reflect.setPrototypeOf(MENU, Menu.prototype);
    display(MENU); 
}
    docName.innerText = document.title+" "+VERSION;
    // 'this' is undefined
    //File.prototype.toString = () => this.name;
    try {
        inspect(document.body, init);
        inp.value = "new Number(c.pi)";
    } catch(e) {
        reportError(e);
    }

// tab data
var tabs = [];
// inspector.html sends a message to sss-helper (extension)ere
// extension returnes list of doms as a respond
function getDoms(){
    console.log("Message sending...");
        // The ID of the extension we want to talk to.
        var editorExtensionId = "bjloackbmeialfgffmdmoajebndoclan"; // this could be change
        var url = "https://github.com";
        // Make a simple request:
        chrome.runtime.sendMessage(editorExtensionId, {openUrlInEditor: url},
        function(response) {
            console.log("Response came from extension...");
            // save tab data from response
            console.log(response);
            tabs = response;
            fillDom();
        });
    console.log("Message sended...");
}
function fillDom(){
    var combo = document.getElementById("tabs");
    combo.innerHTML = "";

    for (let i = 0; i < tabs.length; i++) {
        var will = '<option value="'+i+'">'+tabs[i]['title']+'</option>';
        combo.innerHTML += will;
    }
}

function importDom(){
    var combo = document.getElementById("tabs");
    var tab = combo.options[combo.selectedIndex].value;
    console.log(combo.selectedIndex);
    var dom = document.createElement('div');
    dom.innerHTML = tab.trim();
    // initilaize the inspector with spsific dom
    document.innerHTML = "";
    inspect(document.body, init);
}
</script>
<p><input type=file multiple onChange='fileSelect(this)' />
</p>
<button onclick="getDoms()">Get all tabs</button>
<select id="tabs"><option value="default">No tabs here...</option></select>
<button onclick="importDom()">Import selected dom</button>
<pre id=disp1></pre>
<img id=disp2 />
</body>
</html>
